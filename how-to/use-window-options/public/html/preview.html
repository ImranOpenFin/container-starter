<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Window Options Preview</title>
  <meta name="description"
        content="" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1" />
  <link rel="preconnect"
        href="https://fonts.googleapis.com" />
  <link rel="preconnect"
        href="https://fonts.gstatic.com"
        crossorigin="" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
  <link rel="stylesheet"
        href="../style/app.css" />
</head>

<body class="col fill gap20">
  <header class="row spread middle">
    <div class="col">
      <h1>Window Options Preview</h1>
      <h1 class="tag">Demonstrate the customization options available for opening windows.</h1>
    </div>
    <div class="row middle gap20">
      <image src="../images/icon-blue.png"
             alt="OpenFin"
             height="40px"></image>
    </div>
  </header>
  <main class="row fill gap20">
    <p>This is the preview window.</p>
  </main>
  <footer>
    <div class="row spread">
      <button id="btnCapture">Capture</button>
      <button id="btnClosePreview">Close</button>
    </div>
  </footer>
  <script>
    const btnClosePreview = document.querySelector("#btnClosePreview");
    btnClosePreview.addEventListener("click", async () => (await fin.Window.getCurrent()).close());

    const btnCapture = document.querySelector("#btnCapture");
    btnCapture.addEventListener("click", async () => {
      console.log("SnapShot clicked");
      const wnd = await fin.Window.getCurrent();

      // Snapshot of a full visible window
      let base64 = await wnd.getSnapshot();

      const link = document.createElement("a");
      link.setAttribute("href", "data:image/png;base64," + base64);
      link.setAttribute("download", "openfin-window-settings.png");
      link.click();
    });

    function updateTheme() {
      if (localStorage.getItem("use-window-options/theme") === "light") {
        document.body.classList.add("theme-light");
      } else {
        document.body.classList.remove("theme-light");
      }
    }

    window.addEventListener('storage', event => updateTheme());

    updateTheme();
  </script>
</body>

</html>